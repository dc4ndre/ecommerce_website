<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - E-Commerce System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <nav class="dashboard-nav">
                <div class="nav-brand">
                    <i class="fas fa-user-shield"></i>
                    Admin Dashboard
                </div>
                
                <div class="nav-menu">
                    <button class="btn btn-outline" onclick="showSection('overview')">
                        <i class="fas fa-chart-bar"></i>
                        Overview
                    </button>
                    <button class="btn btn-outline" onclick="showSection('products')">
                        <i class="fas fa-boxes"></i>
                        Products
                    </button>
                    <button class="btn btn-outline" onclick="showSection('orders')">
                        <i class="fas fa-receipt"></i>
                        Orders
                    </button>
                    <button class="btn btn-outline" onclick="showSection('users')">
                        <i class="fas fa-users"></i>
                        Users
                    </button>
                </div>
                
                <div class="nav-user">
                    <span>Admin: {{ user.username }}</span>
                    <a href="/logout" class="btn btn-danger">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="dashboard-content">
            <!-- Overview Section -->
            <section id="overviewSection" class="content-section">
                <div class="content-header">
                    <h1 class="content-title">Dashboard Overview</h1>
                    <p class="content-subtitle">Manage your e-commerce platform</p>
                </div>
                
                <div class="features-grid">
                    <div class="feature-card" onclick="showSection('products')">
                        <div class="feature-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <h3>Product Management</h3>
                        <p>Add, edit, and manage your product catalog</p>
                        <div style="margin-top: 1rem; font-size: 2rem; font-weight: bold; color: var(--primary-red);" id="productCount">-</div>
                    </div>
                    
                    <div class="feature-card" onclick="showSection('orders')">
                        <div class="feature-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3>Order Management</h3>
                        <p>Process orders and update delivery status</p>
                        <div style="margin-top: 1rem; font-size: 2rem; font-weight: bold; color: var(--primary-red);" id="orderCount">-</div>
                    </div>
                    
                    <div class="feature-card" onclick="showSection('users')">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>User Management</h3>
                        <p>View and manage customer accounts</p>
                        <div style="margin-top: 1rem; font-size: 2rem; font-weight: bold; color: var(--primary-red);" id="userCount">-</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <h3>Data Structures</h3>
                        <p>System uses advanced algorithms for optimal performance</p>
                        <div style="margin-top: 1rem;">
                            <small style="color: var(--text-light);">
                                Queue • Stack • Tree • Hash Table • Linked List
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="card-actions">
                            <button class="btn btn-success" onclick="showAddProductModal()">
                                <i class="fas fa-plus"></i>
                                Add New Product
                            </button>
                            <button class="btn btn-outline" onclick="processNextOrder()">
                                <i class="fas fa-play"></i>
                                Process Next Order
                            </button>
                            <button class="btn btn-outline" onclick="exportData()">
                                <i class="fas fa-download"></i>
                                Export Data
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section id="productsSection" class="content-section" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Product Management</h1>
                    <div class="card-actions" style="margin-top: 1rem;">
                        <button class="btn btn-success" onclick="showAddProductModal()">
                            <i class="fas fa-plus"></i>
                            Add Product
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Products</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table" id="productsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Products will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="ordersSection" class="content-section" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Order Management</h1>
                    <div class="card-actions" style="margin-top: 1rem;">
                        <button class="btn btn-success" onclick="processNextOrder()">
                            <i class="fas fa-play"></i>
                            Process Next Order
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Orders</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table" id="ordersTable">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="usersSection" class="content-section" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">User Management</h1>
                    <p class="content-subtitle">View customer accounts and transaction history</p>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Users</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Orders</th>
                                        <th>Total Spent</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Add/Edit Product Modal -->
        <div class="modal" id="productModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="productModalTitle">Add Product</h2>
                    <button class="modal-close" onclick="closeProductModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="productAlerts"></div>
                    
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        
                        <div class="form-group">
                            <label class="form-label">Product Name</label>
                            <input type="text" id="productName" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea id="productDescription" class="form-input" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Price</label>
                            <input type="number" id="productPrice" class="form-input" step="0.01" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Stock Quantity</label>
                            <input type="number" id="productStock" class="form-input" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select id="productCategory" class="form-input" required>
                                <option value="">Select Category</option>
                                <option value="1">Electronics</option>
                                <option value="2">Clothing</option>
                                <option value="3">Books</option>
                                <option value="4">Home & Garden</option>
                                <option value="5">Smartphones</option>
                                <option value="6">Laptops</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Product Image</label>
                            <input type="file" id="productImageFile" class="form-input" accept="image/*">
                            <input type="hidden" id="productImage" name="image_path">
                            <div id="imagePreview" style="margin-top: 1rem; display: none;">
                                <img id="previewImg" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                            </div>
                            <small style="color: var(--text-light);">Upload PNG, JPG, JPEG, or GIF files</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select id="productStatus" class="form-input">
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeProductModal()">Cancel</button>
                    <button class="btn btn-success" onclick="saveProduct()">
                        <i class="fas fa-save"></i>
                        Save Product
                    </button>
                </div>
            </div>
        </div>

        <!-- Order Status Modal -->
        <div class="modal" id="orderModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Update Order Status</h2>
                    <button class="modal-close" onclick="closeOrderModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="orderAlerts"></div>
                    
                    <form id="orderForm">
                        <input type="hidden" id="orderId">
                        
                        <div class="form-group">
                            <label class="form-label">Order Status</label>
                            <select id="orderStatus" class="form-input" required>
                                <option value="pending">Pending</option>
                                <option value="processing">Processing</option>
                                <option value="shipping">Shipping</option>
                                <option value="delivered">Delivered</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Expected Delivery (Optional)</label>
                            <input type="date" id="expectedDelivery" class="form-input">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeOrderModal()">Cancel</button>
                    <button class="btn btn-success" onclick="updateOrderStatus()">
                        <i class="fas fa-save"></i>
                        Update Status
                    </button>
                </div>
            </div>
        </div>

        <!-- User Transactions Modal -->
        <div class="modal" id="userModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="userModalTitle">User Transactions</h2>
                    <button class="modal-close" onclick="closeUserModal()">&times;</button>
                </div>
                <div class="modal-body" id="userModalBody">
                    <!-- Transaction data will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeUserModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSection = 'overview';
        let productsData = [];
        let ordersData = [];
        let usersData = [];

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadOverviewData();
        });

        // Section management
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').style.display = 'block';
            currentSection = sectionName;

            // Load section data
            switch(sectionName) {
                case 'overview':
                    loadOverviewData();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'users':
                    loadUsers();
                    break;
            }
        }

        // Overview functionality
        async function loadOverviewData() {
            try {
                const [productsRes, ordersRes, usersRes] = await Promise.all([
                    fetch('/api/admin/products'),
                    fetch('/api/admin/orders'),
                    fetch('/api/admin/users')
                ]);

                const products = await productsRes.json();
                const orders = await ordersRes.json();
                const users = await usersRes.json();

                document.getElementById('productCount').textContent = products.length;
                document.getElementById('orderCount').textContent = orders.length;
                document.getElementById('userCount').textContent = users.length;
            } catch (error) {
                console.error('Error loading overview data:', error);
            }
        }

        // Products functionality
        async function loadProducts() {
            try {
                const response = await fetch('/api/admin/products');
                productsData = await response.json();
                displayProducts();
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // Image upload handling
        document.addEventListener('DOMContentLoaded', function() {
            const imageUpload = document.getElementById('productImageFile');
            if (imageUpload) {
                imageUpload.addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    try {
                        showProductAlert('info', 'Uploading image...');
                        
                        const response = await fetch('/upload_image', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            document.getElementById('productImage').value = result.filename;
                            
                            // Show preview
                            const preview = document.getElementById('imagePreview');
                            const previewImg = document.getElementById('previewImg');
                            previewImg.src = `/static/images/${result.filename}`;
                            preview.style.display = 'block';
                            
                            showProductAlert('success', 'Image uploaded successfully!');
                        } else {
                            showProductAlert('error', result.message);
                        }
                    } catch (error) {
                        console.error('Upload error:', error);
                        showProductAlert('error', 'Failed to upload image');
                    }
                });
            }
        });

        function displayProducts() {
            const tbody = document.querySelector('#productsTable tbody');
            
            if (productsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-light);">No products found</td></tr>';
                return;
            }

            tbody.innerHTML = productsData.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.price_formatted}</td>
                    <td>${product.stock}</td>
                    <td>
                        <span class="badge badge-${product.is_active ? 'delivered' : 'cancelled'}">${product.is_active ? 'Active' : 'Inactive'}</span>
                    </td>
                    <td>
                        <button class="btn btn-outline" onclick="editProduct(${product.id})" style="margin-right: 0.5rem;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteProduct(${product.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function showAddProductModal() {
            document.getElementById('productModalTitle').textContent = 'Add Product';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            clearProductAlerts();
            document.getElementById('productModal').classList.add('active');
        }

        function editProduct(productId) {
        const product = productsData.find(p => p.id === productId);
        if (!product) return;

        document.getElementById('productModalTitle').textContent = 'Edit Product';
        document.getElementById('productId').value = product.id;
        document.getElementById('productName').value = product.name;
        document.getElementById('productDescription').value = product.description || '';
        document.getElementById('productPrice').value = product.price;
        document.getElementById('productStock').value = product.stock;
        document.getElementById('productCategory').value = product.category_id;
        document.getElementById('productImage').value = product.image_path || '';
        document.getElementById('productStatus').value = product.is_active ? '1' : '0';

        // ✅ Show preview if product already has an image
        const preview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        if (product.image_path) {
            previewImg.src = `/static/images/${product.image_path}`;
            preview.style.display = 'block';
        } else {
            preview.style.display = 'none';
        }

        clearProductAlerts();
        document.getElementById('productModal').classList.add('active');
    }

    async function saveProduct() {
        const productId = document.getElementById('productId').value;
        const imagePath = document.getElementById('productImage').value;

        const productData = {
            name: document.getElementById('productName').value,
            description: document.getElementById('productDescription').value,
            price: document.getElementById('productPrice').value,
            stock: document.getElementById('productStock').value,
            category_id: document.getElementById('productCategory').value,
            is_active: document.getElementById('productStatus').value === '1'
        };

        // ✅ Only include image_path if not empty
        if (imagePath) {
            productData.image_path = imagePath;
        }

        // Validate required fields
        if (!productData.name || !productData.price || !productData.stock || !productData.category_id) {
            showProductAlert('error', 'Please fill in all required fields');
            return;
        }

        try {
            const url = productId ? `/api/admin/products/${productId}` : '/api/admin/products';
            const method = productId ? 'PUT' : 'POST';

            const response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(productData)
            });

            const result = await response.json();
            
            if (result.success) {
                showProductAlert('success', `Product ${productId ? 'updated' : 'added'} successfully!`);
                setTimeout(() => {
                    closeProductModal();
                    loadProducts();
                    if (currentSection === 'overview') loadOverviewData();
                }, 1500);
            } else {
                showProductAlert('error', result.message || 'Failed to save product');
            }
        } catch (error) {
            console.error('Error saving product:', error);
            showProductAlert('error', 'Error saving product. Please try again.');
        }
    }

        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;

            try {
                const response = await fetch(`/api/admin/products/${productId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', 'Product deleted successfully!');
                    loadProducts();
                    if (currentSection === 'overview') loadOverviewData();
                } else {
                    showAlert('error', 'Failed to delete product');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                showAlert('error', 'Error deleting product');
            }
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
        }

        // Orders functionality
        async function loadOrders() {
            try {
                const response = await fetch('/api/admin/orders');
                ordersData = await response.json();
                displayOrders();
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        function displayOrders() {
            const tbody = document.querySelector('#ordersTable tbody');
            
            if (ordersData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-light);">No orders found</td></tr>';
                return;
            }

            tbody.innerHTML = ordersData.map(order => `
                <tr>
                    <td>#${order.id}</td>
                    <td>${order.customer}</td>
                    <td>₱${order.total}</td>
                    <td><span class="badge badge-${order.status}">${order.status}</span></td>
                    <td>${new Date(order.date).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-outline" onclick="updateOrderStatusModal(${order.id}, '${order.status}')" style="margin-right: 0.5rem;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline" onclick="viewOrderDetails(${order.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateOrderStatusModal(orderId, currentStatus) {
            document.getElementById('orderId').value = orderId;
            document.getElementById('orderStatus').value = currentStatus;
            clearOrderAlerts();
            document.getElementById('orderModal').classList.add('active');
        }

        async function updateOrderStatus() {
            const orderId = document.getElementById('orderId').value;
            const status = document.getElementById('orderStatus').value;
            const expectedDelivery = document.getElementById('expectedDelivery').value;

            try {
                const response = await fetch(`/api/admin/orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        status: status,
                        expected_delivery: expectedDelivery
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showOrderAlert('success', 'Order status updated successfully!');
                    setTimeout(() => {
                        closeOrderModal();
                        loadOrders();
                    }, 1500);
                } else {
                    showOrderAlert('error', result.message || 'Failed to update order status');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                showOrderAlert('error', 'Error updating order status');
            }
        }

        async function processNextOrder() {
            try {
                const response = await fetch('/api/admin/process_orders', {
                    method: 'POST'
                });

                const result = await response.json();
                showAlert('success', result.message);
                
                // Refresh orders after a delay
                setTimeout(() => {
                    if (currentSection === 'orders') loadOrders();
                }, 1000);
            } catch (error) {
                console.error('Error processing order:', error);
                showAlert('error', 'Error processing order');
            }
        }

        function viewOrderDetails(orderId) {
            const order = ordersData.find(o => o.id === orderId);
            if (!order) return;

            alert(`Order Details:
            
Order ID: #${order.id}
Customer: ${order.customer}
Email: ${order.email}
Total: ${order.total_formatted}
Status: ${order.status}
Address: ${order.address}
Contact: ${order.contact}
Date: ${new Date(order.date).toLocaleString()}`);
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.remove('active');
        }

        // Users functionality
        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                usersData = await response.json();
                displayUsers();
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function displayUsers() {
            const tbody = document.querySelector('#usersTable tbody');
            
            if (usersData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-light);">No users found</td></tr>';
                return;
            }

            tbody.innerHTML = usersData.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${user.order_count}</td>
                    <td>${user.total_spent_formatted}</td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-outline" onclick="viewUserTransactions(${user.id}, '${user.username}')">
                            <i class="fas fa-eye"></i>
                            Transactions
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        async function viewUserTransactions(userId, username) {
            try {
                const response = await fetch(`/api/admin/users/${userId}/transactions`);
                const data = await response.json();
                
                document.getElementById('userModalTitle').textContent = `${username} - Transaction History`;
                document.getElementById('userModalBody').innerHTML = `
                    <div style="margin-bottom: 2rem; padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <strong>Total Orders:</strong> <span>${data.total_orders}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Total Spent:</strong> <span style="color: var(--primary-red); font-weight: bold;">${data.total_spent}</span>
                        </div>
                    </div>
                    
                    ${data.transactions.length > 0 ? `
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Date</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.transactions.map(transaction => `
                                        <tr>
                                            <td>#${transaction.order_id}</td>
                                            <td>${new Date(transaction.date).toLocaleDateString()}</td>
                                            <td>${transaction.item_count}</td>
                                            <td>${transaction.total_formatted}</td>
                                            <td><span class="badge badge-${transaction.status}">${transaction.status}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : '<p style="text-align: center; color: var(--text-light); padding: 2rem;">No transactions found</p>'}
                `;
                
                document.getElementById('userModal').classList.add('active');
            } catch (error) {
                console.error('Error loading user transactions:', error);
                showAlert('error', 'Error loading user transactions');
            }
        }

        function closeUserModal() {
            document.getElementById('userModal').classList.remove('active');
        }

        // Utility functions
        function exportData() {
            const data = {
                products: productsData,
                orders: ordersData,
                users: usersData,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ecommerce_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('success', 'Data exported successfully!');
        }

        function showAlert(type, message) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            
            document.body.insertBefore(alert, document.body.firstChild);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function showProductAlert(type, message) {
            const alertContainer = document.getElementById('productAlerts');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            
            alertContainer.innerHTML = `
                <div class="alert ${alertClass}">
                    <i class="fas ${icon}"></i>
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                if (type !== 'success') alertContainer.innerHTML = '';
            }, 5000);
        }

        function clearProductAlerts() {
            document.getElementById('productAlerts').innerHTML = '';
        }

        function showOrderAlert(type, message) {
            const alertContainer = document.getElementById('orderAlerts');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            
            alertContainer.innerHTML = `
                <div class="alert ${alertClass}">
                    <i class="fas ${icon}"></i>
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                if (type !== 'success') alertContainer.innerHTML = '';
            }, 5000);
        }

        function clearOrderAlerts() {
            document.getElementById('orderAlerts').innerHTML = '';
        }

        // Close modals on outside click
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    </script>
</body>
</html>